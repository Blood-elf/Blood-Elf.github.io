(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{272:function(a,s,e){a.exports=e.p+"assets/img/640-1.67a9aaa6.png"},273:function(a,s,e){a.exports=e.p+"assets/img/640.5628c91d.gif"},346:function(a,s,e){"use strict";e.r(s);var t=e(0),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"vue-项目优化（二）：webpack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vue-项目优化（二）：webpack","aria-hidden":"true"}},[a._v("#")]),a._v(" Vue 项目优化（二）：webpack")]),a._v(" "),t("h2",{attrs:{id:"webpack-对图片进行压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack-对图片进行压缩","aria-hidden":"true"}},[a._v("#")]),a._v(" Webpack 对图片进行压缩")]),a._v(" "),t("p",[a._v("在 vue 项目中除了可以在 webpack.base.conf.js 中 url-loader 中设置 limit 大小来对图片处理，对小于 limit 的图片转化为 base64 格式，其余的不做操作。所以对有些较大的图片资源，在请求资源的时候，加载会很慢，我们可以用 image-webpack-loader来压缩图片：")]),a._v(" "),t("p",[t("strong",[a._v("（1）首先，安装 image-webpack-loader  ：")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("npm install image-webpack-loader --save-devbr\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("strong",[a._v("（2）然后，在 webpack.base.conf.js  中进行配置：")])]),a._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[a._v("/\\.(png|jpe?g|gif|svg)(\\?.*)?$/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  use"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'url-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        limit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" utils"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("assetsPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'img/[name].[hash:7].[ext]'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'image-webpack-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" bypassOnDebug"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("      \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br")])]),t("h2",{attrs:{id:"减少-es6-转为-es5-的冗余代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#减少-es6-转为-es5-的冗余代码","aria-hidden":"true"}},[a._v("#")]),a._v(" 减少 ES6 转为 ES5 的冗余代码")]),a._v(" "),t("p",[a._v("Babel 插件会在将 ES6 代码转换成 ES5 代码时会注入一些辅助函数，例如下面的 ES6 代码：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("class HelloWebpack extends Component{...}br\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("这段代码再被转换成能正常运行的 ES5 代码时需要以下两个辅助函数：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("babel-runtime/helpers/createClass // 用于实现 class 语法babel-runtime/helpers/inherits // 用于实现 extends 语法br\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("在默认情况下， Babel 会在每个输出文件中内嵌这些依赖的辅助函数代码，如果多个源代码文件都依赖这些辅助函数，那么这些辅助函数的代码将会出现很多次，造成代码冗余。为了不让这些辅助函数的代码重复出现，可以在依赖它们时通过 require('babel-runtime/helpers/createClass') 的方式导入，这样就能做到只让它们出现一次。babel-plugin-transform-runtime 插件就是用来实现这个作用的，将相关辅助函数进行替换成导入语句，从而减小 babel 编译出来的代码的文件大小。")]),a._v(" "),t("p",[t("strong",[a._v("（1）首先，安装 babel-plugin-transform-runtime ：")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("npm install babel-plugin-transform-runtime --save-devbr\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("strong",[a._v("（2）然后，修改 .babelrc  配置文件为：")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('"plugins": [ "transform-runtime"]br\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("如果要看插件的更多详细内容，可以查看babel-plugin-transform-runtime 的 详细介绍。")]),a._v(" "),t("h2",{attrs:{id:"提取公共代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提取公共代码","aria-hidden":"true"}},[a._v("#")]),a._v(" 提取公共代码")]),a._v(" "),t("p",[a._v("如果项目中没有去将每个页面的第三方库和公共模块提取出来，则项目会存在以下问题：")]),a._v(" "),t("ul",[t("li",[a._v("相同的资源被重复加载，浪费用户的流量和服务器的成本。")]),a._v(" "),t("li",[a._v("每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。")])]),a._v(" "),t("p",[a._v("所以我们需要将多个页面的公共代码抽离成单独的文件，来优化以上问题 。Webpack 内置了专门用于提取多个Chunk 中的公共部分的插件 CommonsChunkPlugin，我们在项目中 CommonsChunkPlugin 的配置如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("// 所有在 package.json 里面依赖的包，都会被打包进 vendor.js 这个文件中。new webpack.optimize.CommonsChunkPlugin({ name: 'vendor', minChunks: function(module, count) { return ( module.resource && /\\.js$/.test(module.resource) && module.resource.indexOf( path.join(__dirname, '../node_modules') ) === 0 ); }}),// 抽取出代码模块的映射关系new webpack.optimize.CommonsChunkPlugin({ name: 'manifest', chunks: ['vendor']})br\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("如果要看插件的更多详细内容，可以查看 CommonsChunkPlugin 的 详细介绍。")]),a._v(" "),t("h2",{attrs:{id:"模板预编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模板预编译","aria-hidden":"true"}},[a._v("#")]),a._v(" 模板预编译")]),a._v(" "),t("p",[a._v("当使用 DOM 内模板或 JavaScript 内的字符串模板时，模板会在运行时被编译为渲染函数。通常情况下这个过程已经足够快了，但对性能敏感的应用还是最好避免这种用法。")]),a._v(" "),t("p",[a._v("预编译模板最简单的方式就是使用单文件组件——相关的构建设置会自动把预编译处理好，所以构建好的代码已经包含了编译出来的渲染函数而不是原始的模板字符串。")]),a._v(" "),t("p",[a._v("如果你使用 webpack，并且喜欢分离 JavaScript 和模板文件，你可以使用 vue-template-loader，它也可以在构建过程中把模板文件转换成为 JavaScript 渲染函数。")]),a._v(" "),t("h2",{attrs:{id:"提取组件的-css"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提取组件的-css","aria-hidden":"true"}},[a._v("#")]),a._v(" 提取组件的 CSS")]),a._v(" "),t("p",[a._v("当使用单文件组件时，组件内的 CSS 会以 style 标签的方式通过 JavaScript 动态注入。这有一些小小的运行时开销，如果你使用服务端渲染，这会导致一段 “无样式内容闪烁 (fouc) ” 。将所有组件的 CSS 提取到同一个文件可以避免这个问题，也会让 CSS 更好地进行压缩和缓存。")]),a._v(" "),t("p",[a._v("查阅这个构建工具各自的文档来了解更多：")]),a._v(" "),t("ul",[t("li",[a._v("webpack + vue-loader ( vue-cli 的 webpack 模板已经预先配置好)")]),a._v(" "),t("li",[a._v("Browserify + vueify")]),a._v(" "),t("li",[a._v("Rollup + rollup-plugin-vue")])]),a._v(" "),t("h2",{attrs:{id:"优化-sourcemap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化-sourcemap","aria-hidden":"true"}},[a._v("#")]),a._v(" 优化 SourceMap")]),a._v(" "),t("p",[a._v("我们在项目进行打包后，会将开发中的多个文件代码打包到一个文件中，并且经过压缩、去掉多余的空格、babel编译化后，最终将编译得到的代码会用于线上环境，那么这样处理后的代码和源代码会有很大的差别，当有 bug的时候，我们只能定位到压缩处理后的代码位置，无法定位到开发环境中的代码，对于开发来说不好调式定位问题，因此 sourceMap 出现了，它就是为了解决不好调式代码问题的。")]),a._v(" "),t("p",[a._v("SourceMap 的可选值如下（+ 号越多，代表速度越快，- 号越多，代表速度越慢, o 代表中等速度 ）")]),a._v(" "),t("p",[t("img",{attrs:{src:e(272),alt:"img"}})]),a._v(" "),t("p",[a._v("开发环境推荐：cheap-module-eval-source-map")]),a._v(" "),t("p",[a._v("生产环境推荐：cheap-module-source-map")]),a._v(" "),t("p",[t("strong",[a._v("原因如下：")])]),a._v(" "),t("ul",[t("li",[a._v("cheap：源代码中的列信息是没有任何作用，因此我们打包后的文件不希望包含列相关信息，只有行信息能建立打包前后的依赖关系。因此不管是开发环境或生产环境，我们都希望添加 cheap 的基本类型来忽略打包前后的列信息；")]),a._v(" "),t("li",[a._v("module ：不管是开发环境还是正式环境，我们都希望能定位到bug的源代码具体的位置，比如说某个 Vue 文件报错了，我们希望能定位到具体的 Vue 文件，因此我们也需要 module 配置；")]),a._v(" "),t("li",[a._v("soure-map ：source-map 会为每一个打包后的模块生成独立的 soucemap 文件 ，因此我们需要增加source-map 属性；")]),a._v(" "),t("li",[a._v("eval-source-map：eval 打包代码的速度非常快，因为它不生成 map 文件，但是可以对 eval 组合使用 eval-source-map 使用会将 map 文件以 DataURL 的形式存在打包后的 js 文件中。在正式环境中不要使用 eval-source-map, 因为它会增加文件的大小，但是在开发环境中，可以试用下，因为他们打包的速度很快。")])]),a._v(" "),t("h2",{attrs:{id:"构建结果输出分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建结果输出分析","aria-hidden":"true"}},[a._v("#")]),a._v(" 构建结果输出分析")]),a._v(" "),t("p",[a._v("Webpack 输出的代码可读性非常差而且文件非常大，让我们非常头疼。为了更简单、直观地分析输出结果，社区中出现了许多可视化分析工具。这些工具以图形的方式将结果更直观地展示出来，让我们快速了解问题所在。接下来讲解我们在 Vue 项目中用到的分析工具：webpack-bundle-analyzer 。")]),a._v(" "),t("p",[a._v("我们在项目中 webpack.prod.conf.js 进行配置：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("if (config.build.bundleAnalyzerReport) { var BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin; webpackConfig.plugins.push(new BundleAnalyzerPlugin());}br\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("执行  $ npm run build --report  后生成分析报告如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:e(273),alt:"img"}})]),a._v(" "),t("h2",{attrs:{id:"vue-项目的编译优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vue-项目的编译优化","aria-hidden":"true"}},[a._v("#")]),a._v(" Vue 项目的编译优化")]),a._v(" "),t("p",[a._v("如果你的 Vue 项目使用 Webpack 编译，需要你喝一杯咖啡的时间，那么也许你需要对项目的 Webpack 配置进行优化，提高 Webpack 的构建效率。具体如何进行 Vue 项目的 Webpack 构建优化，可以参考作者的另一篇文章《 Vue 项目 Webpack 优化实践》")])])}),[],!1,null,null,null);s.default=n.exports}}]);